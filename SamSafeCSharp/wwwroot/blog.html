<!DOCTYPE html>
<html>
<head>
    <title>SAM Sample | Blog Posts</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Blog Template for Bootstrap Using the SAM Pattern</title>

    <!-- Bootstrap core CSS -->
    <link href="http://getbootstrap.com/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <link href="http://getbootstrap.com/assets/css/ie10-viewport-bug-workaround.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="http://getbootstrap.com/examples/blog/blog.css" rel="stylesheet">

    <!-- Just for debugging purposes. Don't actually copy these 2 lines! -->
    <!--[if lt IE 9]><script src="../../assets/js/ie8-responsive-file-warning.js"></script><![endif]-->
    <script src="http://getbootstrap.com/assets/js/ie-emulation-modes-warning.js"></script>

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
      <![endif]-->

</head>
<body>

    <div class="blog-masthead">
        <div class="container">
            <nav class="blog-nav">
                <a class="blog-nav-item active" href="#">Home</a>
                <a class="blog-nav-item" href="http://sam.js.org">About</a>
            </nav>
        </div>
    </div>

    <div class="container">

        <div class="blog-header">
            <h1 class="blog-title">The SAM Pattern Blog</h1>
            <p class="lead blog-description">The official blog sample impleting the SAM Pattern</p>
        </div>

        <div class="row">

            <div class="col-sm-8 blog-main">

                <div id="representation">
                    <blockquote>Problem is (follow me closely here, the science is pretty complicated), if I cut a hole in the Hab, the air won't stay inside anymore.</blockquote><br>
                    - Andy Weir, The Martian
                </div>
                <br>
                <br>
                <div class="mdl-cell mdl-cell--6-col">
                    <input id="title" type="text" class="form-control" ><br>
                    <input id="description" type="text" class="form-control"><br>
                    <button id="save" onclick="JavaScript: return actions.save({'title':document.getElementById('title').value, 'description': document.getElementById('description').value});">Add</button>
                    <!--{{#if showCancel}}
                    <button id="cancel" onclick="JavaScript:return actions.cancel({});">Cancel</button>
                    {{/if}}-->
                </div>

            </div>
        </div>

    </div>


    <footer class="blog-footer">
        <p>Blog template built for <a href="http://getbootstrap.com">Bootstrap</a> by <a href="https://twitter.com/mdo">@mdo</a>.</p>
        <p>
            <a href="#">Back to top</a>
        </p>
    </footer>


    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <script>window.jQuery || document.write('<script src="http://getbootstrap.com/assets/js/vendor/jquery.min.js"><\/script>')</script>
    <script src="http://getbootstrap.com/dist/js/bootstrap.min.js"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="http://getbootstrap.com/assets/js/ie10-viewport-bug-workaround.js"></script>

    <!-- The file blog.js is the isomorphic part of the application -->
    <script type="text/javascript" src="blog.js"></script>

    <script type="text/javascript">

        var endpoint = 'http://localhost:2673';
        var samVariantToUse = 'server'; // 'client'

        function travel(data) {
            if (samVariantToUse === 'client') {
                // client side
                model.present(data);
            }
            else if (samVariantToUse === 'server') {
                // server side
                $.get(endpoint + "/dev/samsafe/timetravel/snapshots/" + data.snapshot)
                    .done(function (snapshot) {
                        $.post(endpoint + "/dev/samsafe/timetravel/snapshots/" + data.snapshot, snapshot)
                            .done(function (representation) {
                                $("#representation").html(representation);
                            });
                    }
                    );
            }
        }

        function dispatch(data) {

            // TOOD: check how to empty input
            if (samVariantToUse === 'client') {
                // client side
                model.present(data);
            }
            else if (samVariantToUse === 'server') {
                // server side
                $.ajax({
                    type: "POST",
                    url: endpoint + "/api/samsafe/dispatch",
                    data: JSON.stringify(data),
                    contentType: "application/json",
                    success: function (representation)
                    {
                        var response = JSON.parse(representation);

                        renderPosts(response.posts);
                       
                    }
                });
            }
        }

        function present(data) {
            if (samVariantToUse === 'client') {
                // client side
                model.present(data);
            }
            else if (samVariantToUse === 'server') {
                // server side
                $.ajax({
                    type: "POST",
                    url: endpoint + "/api/samsafe/present",
                    data: JSON.stringify(data),
                    contentType: "application/json",
                    success: function (representation) {
                        $("#representation").html(representation);
                    }
                });
            }
        }

        function init() {
            if (samVariantToUse === 'client') {
                // client side
                view.display(view.init(model));
            }
            else if (samVariantToUse === 'server') {
                // server side
                actions.handle = dispatch;  // set the handler of the actions the dispatcher function.

                $.ajax({
                    type: "GET",
                    url: endpoint + "/api/samsafe/init",
                    success: function (representation) {

                        var response = JSON.parse(representation);

                        renderPosts(response.posts);
                      
                    }
                });
            }
        }

        function renderPosts(posts) {

            //Reponse form server

            //Reset old values
            document.getElementById("representation").innerHTML = '';
            document.getElementById("title").value = "";
            document.getElementById("description").value = "";

            //Render posts
            Array.prototype.forEach.call(posts, post => {

                var representation = document.getElementById("representation");

                representation.innerHTML = representation.innerHTML + '<br><br>' +
                    '<h3 class="blog-post-title" onclick="JavaScript:return actions.edit({\'title\':\'' + post.Title + '\', \'description\':\'' + post.Description + '\', \'id\':\'' + post.Id + '\'});">' + post.Title + '</h3>\n'
                    + '<p class="blog-post-meta">' + post.Description + '</p>'
                    + '<button onclick="JavaScript:return actions.delete({\'id\':\'' + post.Id + '\'});">Delete</button>';

            });

        }

        // Display initial state
        init();

    </script>
</body>
</html>
